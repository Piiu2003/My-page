<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>cashflow ¬∑ local finance tracker</title>
  <style>
    * {
      box-sizing: border-box;
      font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin: 0;
      padding: 0;
    }
    body {
      background: #f4f6fa;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      margin: 16px;
    }
    .card {
      max-width: 1200px;
      width: 100%;
      background: white;
      border-radius: 32px;
      box-shadow: 0 20px 40px -12px rgba(0,20,30,0.25);
      padding: 28px 32px 36px;
    }
    h1 {
      font-size: 1.9rem;
      font-weight: 600;
      letter-spacing: -0.02em;
      display: flex;
      align-items: center;
      gap: 10px;
      color: #0b1e2b;
      margin-bottom: 4px;
    }
    h1 span {
      background: #e6edf5;
      font-size: 1rem;
      font-weight: 400;
      padding: 4px 14px;
      border-radius: 40px;
      color: #1f4a6e;
    }
    .sub {
      color: #5b6f7e;
      font-size: 0.95rem;
      margin-bottom: 28px;
      border-left: 4px solid #a1c6e9;
      padding-left: 16px;
      background: #f0f5fc;
      border-radius: 0 12px 12px 0;
      line-height: 1.5;
    }
    .row-duo {
      display: flex;
      gap: 28px;
      flex-wrap: wrap;
    }
    .form-panel {
      flex: 1.2;
      min-width: 300px;
    }
    .insight-panel {
      flex: 2;
      min-width: 380px;
    }
    .source-group {
      background: #f9fbfd;
      border-radius: 28px;
      padding: 22px 24px;
      margin-bottom: 28px;
      border: 1px solid #dfe9f0;
    }
    .source-group h2 {
      font-size: 1.3rem;
      font-weight: 500;
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 16px;
      color: #1a3a4f;
    }
    .input-grid {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    .field {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    .field label {
      font-weight: 500;
      font-size: 0.9rem;
      color: #2b4d66;
      margin-left: 6px;
    }
    .field input, .field select {
      background: white;
      border: 1.5px solid #cbd7e4;
      border-radius: 24px;
      padding: 12px 18px;
      font-size: 0.95rem;
      outline: none;
      transition: 0.15s;
    }
    .field input:focus, .field select:focus {
      border-color: #2f7eb6;
      box-shadow: 0 0 0 3px rgba(47,126,182,0.12);
    }
    .radio-group {
      display: flex;
      gap: 24px;
      align-items: center;
      background: #eaf1f9;
      padding: 8px 16px;
      border-radius: 40px;
    }
    .radio-group label {
      display: flex;
      align-items: center;
      gap: 6px;
      font-weight: 500;
      color: #1d3c51;
    }
    .btn {
      background: #1f4a6e;
      color: white;
      border: none;
      padding: 14px 22px;
      border-radius: 50px;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.15s;
      border: 1px solid #1f4a6e;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }
    .btn-secondary {
      background: white;
      color: #1f4a6e;
      border: 1.5px solid #b7cfdf;
    }
    .btn-secondary:hover {
      background: #e4eef8;
    }
    .btn:hover {
      background: #0f3752;
      border-color: #0f3752;
    }
    .chip {
      background: white;
      border-radius: 50px;
      padding: 4px 12px;
      font-size: 0.8rem;
      border: 1px solid #bdd6e8;
      color: #1c4d72;
    }
    .summary-cards {
      display: flex;
      gap: 14px;
      flex-wrap: wrap;
      margin-bottom: 24px;
    }
    .stat-card {
      background: white;
      border-radius: 24px;
      padding: 16px 20px;
      flex: 1 1 130px;
      box-shadow: 0 6px 14px #dee9f2;
      border: 1px solid #dae5f0;
    }
    .stat-label {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.6px;
      color: #5f7d99;
    }
    .stat-number {
      font-size: 2rem;
      font-weight: 600;
      line-height: 1.2;
    }
    .positive { color: #197752; }
    .negative { color: #b13e4b; }
    .neutral { color: #1f4a6e; }
    hr {
      border: none;
      border-top: 2px solid #d9e4ee;
      margin: 24px 0 16px;
    }
    .flow-list {
      margin-top: 16px;
      max-height: 340px;
      overflow-y: auto;
      border-radius: 24px;
      background: #f1f7fd;
      padding: 6px 8px;
    }
    .flow-item {
      background: white;
      border-radius: 18px;
      padding: 14px 18px;
      margin-bottom: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-left: 5px solid;
      box-shadow: 0 2px 6px rgba(0,0,0,0.02);
    }
    .flow-item.income { border-left-color: #197752; }
    .flow-item.expense { border-left-color: #b13e4b; }
    .flow-desc {
      display: flex;
      flex-direction: column;
    }
    .flow-cat {
      font-size: 0.75rem;
      text-transform: uppercase;
      color: #607d9b;
      letter-spacing: 0.3px;
    }
    .flow-title {
      font-weight: 600;
      font-size: 1.05rem;
    }
    .flow-amount {
      font-weight: 700;
      font-size: 1.3rem;
    }
    .small-date {
      font-size: 0.7rem;
      color: #8a9fb0;
      margin-top: 4px;
    }
    .action-btns {
      display: flex;
      gap: 12px;
      justify-content: flex-end;
      margin-top: 16px;
    }
    .badge-where {
      background: #e0ebf5;
      border-radius: 30px;
      padding: 8px 18px;
      font-size: 0.9rem;
      font-weight: 500;
    }
    .inline-graph {
      display: flex;
      gap: 8px;
      align-items: center;
      margin: 12px 0 8px;
    }
    .bar {
      height: 10px;
      border-radius: 20px;
      background: #1f4a6e;
    }
    .bar-bg {
      background: #d6e3f0;
      flex: 1;
      border-radius: 20px;
    }
    footer {
      text-align: center;
      color: #a0b8cc;
      font-size: 0.8rem;
      margin-top: 30px;
    }
  </style>
</head>
<body>
<div class="card">
  <h1>üí∏ where2money <span>local only ¬∑ private</span></h1>
  <div class="sub">‚ÜòÔ∏è  track source (income) & where it goes (expense) ‚Äì stored in your browser</div>

  <div class="row-duo">
    <!-- left: entry form -->
    <div class="form-panel">
      <div class="source-group">
        <h2>üìã + new flow</h2>
        <div class="input-grid">
          <div class="field">
            <label>Description</label>
            <input type="text" id="descInput" placeholder="e.g. freelance, groceries..." autocomplete="off">
          </div>
          <div class="field">
            <label>Amount (‚Çπ)</label>
            <input type="number" id="amountInput" step="0.01" min="0.01" value="0.00">
          </div>
          <div class="field">
            <label>Category / source</label>
            <select id="catSelect">
              <option value="Salary">üí∞ Salary / work</option>
              <option value="Freelance">üñ•Ô∏è Freelance</option>
              <option value="Investment">üìà Investment</option>
              <option value="Gift">üéÅ Gift</option>
              <option value="Food">üçî Food / dining</option>
              <option value="Transport">üöó Transport</option>
              <option value="Shopping">üõçÔ∏è Shopping</option>
              <option value="Bills">üí° Bills / utilities</option>
              <option value="Health">üè• Health</option>
              <option value="Other">üìå Other</option>
            </select>
          </div>
          <div class="radio-group">
            <label><input type="radio" name="flowType" value="income" checked> ‚ûï Income (source)</label>
            <label><input type="radio" name="flowType" value="expense"> ‚ûñ Expense (where)</label>
          </div>
          <button class="btn" id="addEntryBtn"> ‚úì add transaction</button>
        </div>
      </div>

      <!-- mini analysis: top sources & where -->
      <div class="source-group">
        <h2>üîç quick peek</h2>
        <div style="margin-bottom: 12px; font-weight: 500;">üìå top income sources</div>
        <div id="topSources" class="badge-where" style="background: #e0f0e4; color:#16673e;"> ‚Äì </div>
        <div style="margin: 16px 0 12px; font-weight: 500;">üìå top expense categories</div>
        <div id="topExpenses" class="badge-where" style="background:#ffe6e8; color:#a13e4b;"> ‚Äì </div>
        <div class="inline-graph" style="margin-top: 24px;">
          <span style="font-size:0.85rem;">üìä in/out ratio</span>
          <div class="bar-bg"><div class="bar" id="ratioBar" style="width:50%; background:#3173a5;"></div></div>
        </div>
      </div>
    </div>

    <!-- right panel: ledger + insights -->
    <div class="insight-panel">
      <!-- summary cards -->
      <div class="summary-cards">
        <div class="stat-card"><div class="stat-label">total income (source)</div><div class="stat-number positive" id="totalIncome">$0</div></div>
        <div class="stat-card"><div class="stat-label">total expenses (where)</div><div class="stat-number negative" id="totalExpense">$0</div></div>
        <div class="stat-card"><div class="stat-label">balance</div><div class="stat-number neutral" id="balance">$0</div></div>
      </div>

      <!-- filter + clear -->
      <div style="display: flex; gap: 8px; align-items: center; margin-bottom: 12px;">
        <span style="background:#f2f2f2; padding:6px 14px; border-radius:30px; font-size:0.85rem;">üîé show:</span>
        <button class="chip" id="filterAll">all</button>
        <button class="chip" id="filterIncome">‚ûï income only</button>
        <button class="chip" id="filterExpense">‚ûñ expense only</button>
        <button class="btn-secondary" id="clearAllBtn" style="padding:8px 16px; margin-left:auto;">‚úï clear all</button>
      </div>

      <!-- transaction list -->
      <div class="flow-list" id="transactionList">
        <!-- dynamic items will appear -->
        <div style="text-align:center; color:#7f99b0; padding:30px;">no transactions yet. add one ‚òùÔ∏è</div>
      </div>
      <div style="font-size:0.75rem; color:#8ba0b5; margin-top:8px;">üíæ all data saved locally in your browser</div>
    </div>
  </div>
  <footer>‚Üí smart analysis: where from, where to ‚Äî always under control</footer>
</div>

<script>
  (function() {
    // storage key
    const STORAGE_KEY = 'cashflow_local_ledger';

    // current filter: 'all', 'income', 'expense'
    let currentFilter = 'all';

    // ----- helper: load/save -----
    function loadTransactions() {
      const stored = localStorage.getItem(STORAGE_KEY);
      if (stored) {
        try {
          return JSON.parse(stored);
        } catch (e) {
          return [];
        }
      }
      return [];
    }

    function saveTransactions(transactions) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(transactions));
    }

    // global data
    let transactions = loadTransactions();

    // ----- DOM elements -----
    const tbody = document.getElementById('transactionList');
    const totalIncomeSpan = document.getElementById('totalIncome');
    const totalExpenseSpan = document.getElementById('totalExpense');
    const balanceSpan = document.getElementById('balance');
    const topSourcesDiv = document.getElementById('topSources');
    const topExpensesDiv = document.getElementById('topExpenses');
    const ratioBar = document.getElementById('ratioBar');

    const descInput = document.getElementById('descInput');
    const amountInput = document.getElementById('amountInput');
    const catSelect = document.getElementById('catSelect');
    const addBtn = document.getElementById('addEntryBtn');
    const filterAllBtn = document.getElementById('filterAll');
    const filterIncomeBtn = document.getElementById('filterIncome');
    const filterExpenseBtn = document.getElementById('filterExpense');
    const clearAllBtn = document.getElementById('clearAllBtn');

    // ----- render helpers -----
    function getFiltered() {
      if (currentFilter === 'income') return transactions.filter(t => t.type === 'income');
      if (currentFilter === 'expense') return transactions.filter(t => t.type === 'expense');
      return transactions; // all
    }

    function formatMoney(amount) {
      return '‚Çπ' + Number(amount).toFixed(2);
    }

    // compute totals & insights
    function updateInsights() {
      let totalIncome = 0, totalExpense = 0;
      const incomeCat = {};
      const expenseCat = {};

      transactions.forEach(t => {
        const amt = Number(t.amount) || 0;
        if (t.type === 'income') {
          totalIncome += amt;
          incomeCat[t.category] = (incomeCat[t.category] || 0) + amt;
        } else {
          totalExpense += amt;
          expenseCat[t.category] = (expenseCat[t.category] || 0) + amt;
        }
      });

      const balance = totalIncome - totalExpense;
      totalIncomeSpan.textContent = formatMoney(totalIncome);
      totalExpenseSpan.textContent = formatMoney(totalExpense);
      balanceSpan.textContent = formatMoney(balance);
      if (balance < 0) balanceSpan.style.color = '#b13e4b'; else if (balance > 0) balanceSpan.style.color = '#197752'; else balanceSpan.style.color = '#1f4a6e';

      // top sources (income)
      let topSourceText = '‚Äî';
      const sortedIncome = Object.entries(incomeCat).sort((a,b) => b[1] - a[1]);
      if (sortedIncome.length) {
        topSourceText = sortedIncome.slice(0, 2).map(([cat, val]) => `${cat} ${formatMoney(val)}`).join(' ¬∑ ');
      }
      topSourcesDiv.textContent = topSourceText;

      // top expenses
      let topExpenseText = '‚Äî';
      const sortedExpense = Object.entries(expenseCat).sort((a,b) => b[1] - a[1]);
      if (sortedExpense.length) {
        topExpenseText = sortedExpense.slice(0, 2).map(([cat, val]) => `${cat} ${formatMoney(val)}`).join(' ¬∑ ');
      }
      topExpensesDiv.textContent = topExpenseText;

      // ratio bar: total expense / total income (capped)
      let ratio = totalIncome > 0 ? (totalExpense / totalIncome) : 0;
      ratio = Math.min(ratio, 1); // show max 100%
      const percent = ratio * 100;
      ratioBar.style.width = percent + '%';
      if (percent > 85) ratioBar.style.background = '#b13e4b'; else if (percent < 40) ratioBar.style.background = '#197752'; else ratioBar.style.background = '#1f4a6e';
    }

    // render transaction list based on filter
    function renderList() {
      const filtered = getFiltered();
      if (filtered.length === 0) {
        tbody.innerHTML = `<div style="text-align:center; color:#7f99b0; padding:30px;">‚ú® no transactions match ¬∑ add one ‚ú®</div>`;
        updateInsights();
        return;
      }

      // sort by date descending (newest first) ‚Äî we'll use a timestamp if exists, or fallback to index
      const sorted = [...filtered].sort((a,b) => (b.timestamp || 0) - (a.timestamp || 0));

      let html = '';
      sorted.forEach((t, idx) => {
        const dateStr = t.timestamp ? new Date(t.timestamp).toLocaleDateString('en-US', {month:'short', day:'numeric'}) : 'just now';
        const amountCls = t.type === 'income' ? 'positive' : 'negative';
        const sign = t.type === 'income' ? '+' : '‚àí';
        html += `<div class="flow-item ${t.type}">
          <div class="flow-desc">
            <span class="flow-cat">${t.category} ¬∑ ${t.type==='income'?'source':'where'}</span>
            <span class="flow-title">${t.description || 'untitled'}</span>
            <span class="small-date">${dateStr}</span>
          </div>
          <div class="flow-amount ${amountCls}">${sign} ${formatMoney(Math.abs(t.amount))}</div>
        </div>`;
      });
      tbody.innerHTML = html;
      updateInsights();
    }

    // add new entry
    function addTransaction() {
      const desc = descInput.value.trim();
      const amount = parseFloat(amountInput.value);
      const category = catSelect.value;
      const typeElem = document.querySelector('input[name="flowType"]:checked');
      const type = typeElem ? typeElem.value : 'expense';

      if (!desc) {
        alert('please enter a description');
        return;
      }
      if (isNaN(amount) || amount <= 0) {
        alert('amount must be a positive number');
        return;
      }

      const newEntry = {
        id: Date.now() + Math.random().toString(36).substr(2, 5),
        description: desc,
        amount: amount,
        category: category,
        type: type,
        timestamp: Date.now()
      };

      transactions.push(newEntry);
      saveTransactions(transactions);
      
      // reset form
      descInput.value = '';
      amountInput.value = '0.00';
      catSelect.value = 'Salary';
      document.querySelector('input[value="income"]').checked = true; // default income

      renderList();
    }

    // clear all data
    function clearAll() {
      if (transactions.length > 0 && confirm('delete ALL transactions? (cannot undo)')) {
        transactions = [];
        saveTransactions(transactions);
        renderList();
      }
    }

    // filter actions
    function setFilter(filter) {
      currentFilter = filter;
      // style chips (simple)
      [filterAllBtn, filterIncomeBtn, filterExpenseBtn].forEach(btn => btn.style.background = '#ffffff');
      if (filter === 'all') filterAllBtn.style.background = '#c3dffe';
      else if (filter === 'income') filterIncomeBtn.style.background = '#c3f0da';
      else if (filter === 'expense') filterExpenseBtn.style.background = '#ffd9d9';
      renderList();
    }

    // ----- event listeners -----
    addBtn.addEventListener('click', addTransaction);

    filterAllBtn.addEventListener('click', () => setFilter('all'));
    filterIncomeBtn.addEventListener('click', () => setFilter('income'));
    filterExpenseBtn.addEventListener('click', () => setFilter('expense'));
    clearAllBtn.addEventListener('click', clearAll);

    // allow enter key on inputs (optional)
    [descInput, amountInput].forEach(inp => inp.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') addTransaction();
    }));

    // initial render
    renderList();
    setFilter('all'); // sets active style

    // edge: if user manually updates local storage elsewhere (no need)
    window.addEventListener('storage', (e) => {
      if (e.key === STORAGE_KEY) {
        transactions = loadTransactions();
        renderList();
      }
    });
  })();
</script>
</body>
</html>